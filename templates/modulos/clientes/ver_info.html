{% include '/modulos/clientes/admin_header.html' %}

{% set a = arreglo[0] %}

<div class="card shadow-lg rounded-4 p-4 mb-5">
  <!-- Título principal + acciones -->
  <div class="d-flex justify-content-between align-items-start flex-wrap mb-4 border-bottom pb-3">
    <h4 class="text-primary fw-bold mb-3">Información del Residente</h4>

    <div class="d-flex flex-wrap gap-2">
      <!-- Toggle de estado con etiqueta -->
      <div class="d-flex flex-column align-items-start me-3">
        <label for="estadoToggle" class="form-label fw-semibold text-muted mb-1">Estado</label>
        <div class="form-check form-switch">
          <input
            class="form-check-input"
            type="checkbox"
            id="estadoToggle"
            name="estado"
            aria-checked="{{ 'true' if a.estado == 1 else 'false' }}"
            {% if a.activo == 1 %} checked {% endif %}
          >
          <label class="form-check-label ms-2" for="estadoToggle" id="estadoLabel">
            {{ 'Activo' if a.activo == 1 else 'Inactivo' }}
          </label>
        </div>
      </div>

      <!-- Botón Editar -->
      <a href="/edit/{{ a.id }}" class="btn btn-outline-primary d-flex align-items-center">
        <i class="fas fa-edit me-2"></i> Editar
      </a>

      <!-- Botón que abre el modal de eliminación -->
      <button class="btn btn-outline-danger d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#confirmarEliminarModal">
        <i class="fas fa-trash-alt me-2"></i> Eliminar
      </button>

      <!-- Botones de salud -->
      <a href="/historial_medico/{{ a.id }}" class="btn btn-outline-success d-flex align-items-center">
        <i class="fas fa-heartbeat me-2"></i> Reporte Médico
      </a>
      <a href="/medicacion/{{ a.id }}" class="btn btn-outline-success d-flex align-items-center">
        <i class="fas fa-pills me-2"></i> Medicación
      </a>
    </div>
  </div>

  <!-- Sección: Datos Personales -->
  <section class="mb-4">
    <h5 class="text-secondary border-bottom pb-2"><i class="fas fa-user-circle me-2"></i>Datos Personales</h5>
    <div class="row mt-3">
      <div class="col-md-4"><strong><i class="fas fa-user me-1"></i>Nombre:</strong> {{ a.nombre }}</div>
      <div class="col-md-4"><strong>Apellido 1:</strong> {{ a.apellido1 }}</div>
      <div class="col-md-4"><strong>Apellido 2:</strong> {{ a.apellido2 }}</div>
    </div>
    <div class="row mt-2">
      <div class="col-md-4"><strong><i class="fas fa-id-card me-1"></i>Cédula:</strong> {{ a.cedula }}</div>
      <div class="col-md-4"><strong><i class="fas fa-calendar-alt me-1"></i>Fecha de nacimiento:</strong> {{ a.fecha_nacimiento }}</div>
      <div class="col-md-4"><strong><i class="fas fa-venus-mars me-1"></i>Género:</strong> {{ a.genero }}</div>
    </div>
    <div class="row mt-2">
      <div class="col-md-4"><strong><i class="fas fa-heart me-1"></i>Estado civil:</strong> {{ a.estado_civil }}</div>
      <div class="col-md-4"><strong><i class="fas fa-flag me-1"></i>Nacionalidad:</strong> {{ a.nacionalidad }}</div>
      <div class="col-md-4"><strong><i class="fas fa-key me-1"></i>ID:</strong> {{ a.id }}</div>
    </div>
  </section>

  <!-- Sección: Contacto -->
  <section class="mb-4">
    <h5 class="text-secondary border-bottom pb-2"><i class="fas fa-phone-alt me-2"></i>Contacto</h5>
    <div class="row mt-3">
      <div class="col-md-6"><strong><i class="fas fa-map-marker-alt me-1"></i>Dirección:</strong> {{ a.direccion }}</div>
      <div class="col-md-6"><strong><i class="fas fa-phone me-1"></i>Teléfono:</strong> {{ a.telefono_contacto }}</div>
    </div>
  </section>

  <!-- Sección: Contacto Emergencia -->
  <section class="mb-4">
    <h5 class="text-secondary border-bottom pb-2"><i class="fas fa-user-shield me-2"></i>Contacto de Emergencia</h5>
    <div class="row mt-3">
      <div class="col-md-4"><strong>Nombre:</strong> {{ a.contacto_emergencia_nombre }}</div>
      <div class="col-md-4"><strong>Parentesco:</strong> {{ a.contacto_emergencia_parentesco }}</div>
      <div class="col-md-4"><strong>Teléfono:</strong> {{ a.contacto_emergencia_telefono }}</div>
    </div>
  </section>

  <!-- Sección: Salud -->
  <section>
    <h5 class="text-secondary border-bottom pb-2"><i class="fas fa-medkit me-2"></i>Salud</h5>
    <div class="row mt-3">
      <div class="col-md-4"><strong>Movilidad:</strong> {{ a.movilidad }}</div>
      <div class="col-md-6 mt-2 mt-md-0"><strong>Estado mental:</strong> {{ a.estado_mental }}</div>
    </div>
  </section>
</div>

<!-- Modal de Confirmación -->
<div class="modal fade" id="confirmarEliminarModal" tabindex="-1" aria-labelledby="confirmarEliminarLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow rounded-4">
      <div class="modal-header bg-danger text-white rounded-top-4">
        <h5 class="modal-title" id="confirmarEliminarLabel"><i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminación</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        ¿Estás seguro que deseas eliminar al residente <strong>{{ a.nombre }} {{ a.apellido1 }}</strong>? Esta acción no se puede deshacer.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" onclick="confirmarEliminacion()">Sí, eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  // Toggle estado
  const toggle = document.getElementById('estadoToggle');
  const label = document.getElementById('estadoLabel');

  toggle.addEventListener('change', () => {
    const nuevoEstado = toggle.checked ? 1 : 0;
    toggle.disabled = true;

    fetch('/toggle_estado/{{ a.id }}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // 'X-CSRFToken': '{{ csrf_token }}' // Descomenta si usas protección CSRF
      },
      body: JSON.stringify({ estado: nuevoEstado })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        label.textContent = nuevoEstado ? 'Activo' : 'Inactivo';
        toggle.setAttribute('aria-checked', nuevoEstado ? 'true' : 'false');
      } else {
        alert('Error al actualizar estado');
        toggle.checked = !toggle.checked;
      }
      toggle.disabled = false;
    })
    .catch(() => {
      alert('Error de conexión');
      toggle.checked = !toggle.checked;
      toggle.disabled = false;
    });
  });

  // Función de eliminación
  function confirmarEliminacion() {
    window.location.href = "/eliminar/{{ a.id }}";
  }
</script>

{% include 'footer.html' %}

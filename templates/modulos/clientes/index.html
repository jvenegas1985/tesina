{% include 'header.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<div>
  <h3>Lista de Residentes</h3>
</div>

<form class="d-flex mb-3" role="search" onsubmit="return false;">
  <input class="form-control me-2 w-25" type="search" id="buscador" placeholder="Buscar por Cédula o Nombre" aria-label="Buscar" />
  
  <a href="/create" class="btn btn-primary">Crear Nuevo</a>
</form>

<div class="col-12">
  <div class="table-responsive table-sm rounded-2 table-bordered center">
    <table class="table table-striped table-hover">
      <thead class="table table-dark table-hover">
        <tr>
          <th scope="col"># ID</th>
          <th scope="col"># Cedula</th>
          <th scope="col">Nombre</th>
          <th scope="col">Nacionalidad</th>
          <th scope="col">Telefono</th>
          <th scope="col">Direccion</th>
          <th scope="col">Acción</th>
        </tr>
      </thead>
      <tbody id="tabla-resultados">
        {% for a in residentes %}
          <tr>
            <td>{{ a.id }}</td>
            <td>{{ a.cedula }}</td>
            <td>{{ a.nombre + ' ' + a.apellido1 + ' ' + a.apellido2 }}</td>
            <td>{{ a.nacionalidad }}</td>
            <td>{{ a.telefono_contacto }}</td>
            <td>{{ a.direccion }}</td>
            <td>
              <a href="{{ url_for('index_editar', id=a.id) }}" class="btn btn-success" id="btn-edit">Editar</a>
                
              <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#eliminar{{ a.id }}" id="btn-eliminar{{ a.id }}">
                <i class="bi bi-trash3"></i> Eliminar
              </button>
              
            </td>
          </tr>
          <!-- Modal -->
          <div class="modal fade" id="eliminar{{ a.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">Confirmar eliminación</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  ¿Está seguro que desea eliminar este registro?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <a href="{{ url_for('eliminar_residente', id=a.id) }}" class="btn btn-danger">Eliminar</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById("buscador");
    const tablaBody = document.getElementById("tabla-resultados");

    function realizarBusqueda() {
        const query = input.value.trim();
        // Si la búsqueda está vacía, no se hace la petición
        if (!query) {
            return;
                    }

        fetch(`/buscar?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                tablaBody.innerHTML = ""; // Limpiar la tabla
                data.forEach(a => {
                    const tr = document.createElement("tr"); // Crear una nueva fila
                    tr.innerHTML = `
                        <td>${a.id}</td>
                        <td>${a.cedula}</td>
                        <td>${a.nombre} ${a.apellido1} ${a.apellido2}</td>
                        <td>${a.nacionalidad}</td>
                        <td>${a.telefono_contacto}</td>
                        <td>${a.direccion}</td>
                        <td>
                            <a href="/edit/${a.id}" class="btn btn-success" id="btn-edit">Editar</a>
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#eliminar${a.id}" id="btn-eliminar${a.id}">Eliminar</button>
                        </td>
                        
                    `;
                    tablaBody.appendChild(tr); // Agregar la fila a la tabla
                });
            })
            .catch(error => {
                console.error("Error al realizar la búsqueda:", error);
            });
    }

    // Ejecutar la búsqueda cuando se escribe en el campo de texto
    input.addEventListener("input", realizarBusqueda);
});

</script>

{% include 'footer.html' %}
